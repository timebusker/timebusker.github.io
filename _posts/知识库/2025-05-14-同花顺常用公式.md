---
layout: post
title: 同花顺常用公式
author: timebusker
catalog: true
top: false
tags:
  - 股票
  - 股票技术篇
---
#### 集合竞价指标
集合竞价指标可以一目了然的看到最近一段时间集合竞价的开盘情况，通过柱子可以看到集合竞价的成交金额情况和高开低开：
- 柱子越长，代表成交金额越大；
- 绿色代表当天集合竞价低开，红色代表当天集合竞价高开。

```
竞量万:OPENVOL/10000;
竞额万:OPENVOL*OPEN/10000,NODRAW;
昨日收盘价:=REF(CLOSE,1);
今日开盘价:=OPEN;
竞价量1:=OPENVOL,nodraw;
开盘幅度:(OPEN-REF(CLOSE,1))/REF(CLOSE,1)*100,nodraw;
STICKLINE(今日开盘价>=昨日收盘价,0,竞价量1,8,0),colorred;
STICKLINE(今日开盘价<昨日收盘价,0,竞价量1,8,0),colorgreen;
昨日成交量:=REF(VOL,1);
前日成交量:=REF(VOL,2);
竞昨竞比: 竞价量1/REF(竞价量1,1),nodraw;
```
竞价指标一共有4个数据，我分别用不同的颜色标注了。
![](/img/Z笔记附件/2025-05-14-同花顺常用公式_image_1.png)
- **白色：竞量万**，它是竞价的分时的量能，股票的数量以万为单位，指标精确到小数点后1位，四舍五入。
- **黄色：竞额万**，竞价成交的金额，以万元为单位。
- **绿色：开盘幅度**，就是开盘股票的涨跌幅。这个+号，代表正数，高开，-号就代表负数，低开的。
- **蓝色：竞昨竞比**，就是今天的集合竞价的分时量能和昨天集合竞价的分时量能的比值。比值大于1，说明今天是放量了的。比值小于1，说明今天是缩量的。

#### 同花顺涨停板颜色设置
涨停板的股票有涨停基因，也代表人气，主力的标识，那么很多股票涨幅虽然很大，比如只有9.5%，9.3%，我们不点进去看，并不能知道这个股票是否涨停，而在股票里面，时间是争分夺秒的，所以一眼就看出这只股票最近是否有过涨停板，有涨停基因，这非常重要！给涨停板股票设置鲜明颜色以快速检查涨停板股票的日K图。

```
/*欢迎使用同花顺公式系统*/
/*按“CTRL+S”启动AI，可输入需求描述生成相应代码*/
IF(C>=REF(C,1)*1.098 AND C=H) RETURN "涨停";
IF(CLOSE>OPEN) 
 RETURN "阳";
ELSE IF(CLOSE<OPEN)
 RETURN "阴";
ELSE IF(CLOSE==OPEN AND OPEN>=CLOSE[1])
 RETURN "阳";
ELSE IF(CLOSE==OPEN AND OPEN<=CLOSE[1])
 RETURN "阴";
ELSE
 RETURN "阳";
```


#### 冲高回落选股
在同花顺服务器上通过拉取最近30日数据进行数据分析选股。
![](/img/Z笔记附件/2025-05-14-同花顺常用公式_image_2.png)

```
/*欢迎使用同花顺公式系统*/
/*按“CTRL+S”启动AI，可输入需求描述生成相应代码*/
// 【增强版冲高回落选股公式】含当日最低涨幅限制
// 核心参数设置（可自定义）
冲高幅度:=5;     // 最高价相对前收盘涨幅阈值（默认5%）
回落幅度:=4;     // 最高价到收盘价回落幅度（默认3%）
最低涨幅:=2;     // 新增条件：当日收盘涨幅不低于3%
成交金额:=1;     // 单日成交额过滤（单位：亿元）
阶段波动:=10;    // 30日累计涨幅限制（默认±10%）

// 阶段涨幅条件
阶段涨幅条件:= 
(CLOSE/REF(CLOSE,30)-1)*100 > -阶段波动  // 30日累计跌幅不超10%
AND 
(CLOSE/REF(CLOSE,30)-1)*100 < 阶段波动;  // 30日累计涨幅不超10%

// 单日信号模块 
单日信号:= 
(HIGH/REF(CLOSE,1) > 1 + 冲高幅度/100)  // 最高价冲高达标[5](@ref)
AND 
((HIGH - CLOSE)/CLOSE * 100 >= 回落幅度) // 回落幅度达标[4](@ref)
AND 
(CLOSE/REF(CLOSE,1)-1)*100 >= 最低涨幅  // 新增收盘涨幅条件[3](@ref)
AND 
VOL > REF(VOL,1)*1.2;                // 成交量放大20%[1](@ref)

// 过滤模块 
板块过滤:=STRFIND(CODE,'300',1)=0 AND STRFIND(CODE,'688',1)=0;  // 排除创业板/科创板
财务指标:=FINANCE(32)>0 AND FINANCE(33)>0;       // 净利润&营收为正[7](@ref)
流动性:=AMOUNT/(100000000)>=成交金额;            // 成交额过滤[2](@ref)

// 技术面条件
MA5 := MA(C,5);   //5日均线[7](@ref)
MA10 := MA(C,10); //10日均线
MA20 := MA(C,20); //20日均线
MA60 := MA(C,60); //60日均线
COND1 := MA5 > MA60;  //均线多头排列[4](@ref)

// 均线斜率验证（5日均线日增幅>0.5%）
MA5_SLOPE := (MA5 - REF(MA5,1)) / REF(MA5,1) * 100;
COND2 := MA5_SLOPE > 0;  //短期动能强度[3](@ref)

// MACD指标验证（水上金叉）
DIF := EMA(C,12) - EMA(C,26);
DEA := EMA(DIF,9);
COND3 := DIF > DEA AND DIF > 0;  //MACD双线在0轴上方[8](@ref)

// 综合选股条件
选股条件:COUNT(单日信号,50)>=2 
          AND COND1  
          // AND COND2 
          AND 阶段涨幅条件   
          AND 流动性;
```


